<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kosmo.orange.wtf.model.mapper.AdminMapper">


<!--=======================================================================-->
<!-- enter / account -->
<!--=======================================================================-->

    <!--회원가입-->
    <insert id="createAccount" parameterType="AdminVO">
        INSERT INTO manager(mgr_name, mgr_id, mgr_pass)
        VALUES (#{mgr_name}, #{mgr_id}, #{mgr_pass})
    </insert>


    <!--id(email) 중복확인-->
    <select id="idCheck" resultMap="getManager">
        SELECT mgr_id
        FROM manager
        WHERE mgr_id = #{id}
    </select>


    <!--id / name 확인 (비번찾기)-->
    <!--&gt;> 쌤과 얘기하다보니 AJAX를 탈 이유가 없음-->
    <!--<select id="pwCHeck" resultMap="getManager">-->
        <!--SELECT mgr_id, mgr_name-->
        <!--FROM manager-->
        <!--WHERE mgr_id = #{id} and mgr_name = #{name}-->
    <!--</select>-->


    <!--로그인-->
    <select id="login" resultMap="getManager">
        SELECT *
        FROM manager
        WHERE mgr_id = #{id}
    </select>


    <!--id / name 확인-->
    <select id="checkAccount" resultMap="getManager">
        SELECT mgr_id, mgr_name
        FROM manager
        WHERE mgr_id = #{mgr_id} and mgr_name = #{mgr_name}
    </select>


    <!--pw 변경 (random 생성한 임시 pw)-->
    <update id="updatePw" parameterType="AdminVO">
        UPDATE manager
        SET mgr_pass = #{mgr_pass}
        WHERE mgr_id = #{mgr_id}
    </update>


    <!--otp DB에 업데이트-->
    <update id="otpSaveDB" parameterType="AdminVO">
        UPDATE manager
        SET mgr_key = #{mgr_key}
        WHERE mgr_id = #{mgr_id}
    </update>


    <!--DB의 otp 값 가져오기-->
    <select id="otpCheck" resultMap="getManager">
        SELECT *
        FROM manager
        WHERE mgr_id = #{id}
    </select>


<!--=======================================================================-->
<!-- admin page -->
<!--=======================================================================-->

    <!--대시보드(index)페이지 회원 수-->
    <select id="totalUserCount" resultType="int">
        SELECT count(*)
        FROM member
    </select>

    <!--대시보드(index)페이지 가게 수-->
    <select id="totalStoreCount" resultType="int">
        SELECT count(*)
        FROM restaurant
    </select>

    <!--대시보드(index)페이지 리뷰 수-->
    <select id="totalReviewCount" resultType="int">
        SELECT count(*)
        FROM review
    </select>


    <!--유저 목록 불러오기-->
    <select id="memberList" resultMap="getMember">
        SELECT *
        FROM member
    </select>


    <!--가게 리스트-->
    <select id="storeList" resultMap="getRestaurant">
        SELECT *
        FROM restaurant
    </select>


    <!--관리자 (manager) 목록 (list)-->
    <select id="managerList" resultMap="getManager">
        SELECT *
        FROM manager
    </select>


    <!--관리자 익명 게시판 목록 (list)-->
    <select id="boardList" resultMap="getBoard">
        SELECT *
        FROM adminboard
    </select>



<!--=======================================================================-->
<!-- admin page -->
<!--=======================================================================-->

    <!--게시글 저장-->
    <insert id="saveArticle" parameterType="AdminBoardVO">
        INSERT INTO adminboard
              (board_pw, board_title, board_content, board_writer, board_enterdate, board_modifydate)
        VALUES(#{board_pw}, #{board_title}, #{board_content}, #{board_writer}, sysdate(), sysdate())
    </insert>


    <!--수정 및 삭제할 때 pw 맞는지 확인-->
    <select id="boardPwCheck" resultType="int">
        SELECT count(*)
        FROM adminboard
        WHERE board_id = #{board_id} and board_pw = #{board_pw}
    </select>


    <!--수정하기 위해 게시글을 가져와야 합니다.-->
    <select id="boardUpdate" resultMap="getBoard">
        SELECT *
        FROM adminboard
        WHERE board_id = #{board_id} and board_pw = #{board_pw}
    </select>


    <!--게시글 수정-->
    <update id="updateArticle" parameterType="AdminBoardVO">
        UPDATE adminboard
        SET board_pw=#{board_pw}, board_title=#{board_title}, board_content=#{board_content}, board_writer=#{board_writer}, board_modifydate=sysdate()
        WHERE board_id = #{board_id}
    </update>


    <!--게시글 삭제-->
    <delete id="deleteArticle" parameterType="int">
        DELETE FROM adminboard
        WHERE board_id = #{id}
    </delete>


    <!--게시글 상세-->
    <select id="boardDetail" resultMap="getBoard">
        SELECT *
        FROM adminboard
        WHERE board_id = #{id}
    </select>






<!--==============================================================-->
<!--resultMap 설정-->
<!--==============================================================-->

    <resultMap id="getManager" type="AdminVO">
        <result property="mgr_name" column="mgr_name"/>
        <result property="mgr_id" column="mgr_id"/>
        <result property="mgr_pass" column="mgr_pass"/>
    </resultMap>


    <resultMap id="getMember" type="MemberVO">
        <result property="email" column="email"/>
        <result property="password" column="password"/>
        <result property="nickname" column="nickname"/>
        <result property="birthday" column="birth"/>
        <result property="gender" column="gender"/>
        <result property="favor" column="favor"/>
        <result property="point" column="point"/>
        <result property="registDate" column="regist_date"/>
        <result property="exitCheck" column="exit_check"/>
        <result property="exitDate" column="exit_date"/>
    </resultMap>


    <resultMap id="getRestaurant" type="RestaurantVO">
        <result property="resId" column="res_id"/>
        <result property="resName" column="res_name"/>
        <result property="resTell" column="res_tell"/>
        <result property="resAddr" column="res_addr"/>
        <result property="resLatitude" column="res_latitude"/>
        <result property="resLongitude" column="res_longitude"/>
        <result property="resRuntime" column="res_runtime"/>
        <result property="resKeyword" column="res_keyword"/>
        <result property="resRating" column="res_rating"/>
    </resultMap>


    <resultMap id="getBoard" type="AdminBoardVO">
        <result property="board_id" column="board_id"/>
        <result property="board_pw" column="bo
        ard_pw"/>
        <result property="board_title" column="board_title"/>
        <result property="board_content" column="board_content"/>
        <result property="board_writer" column="board_writer"/>
        <result property="board_enterdate" column="board_enterdate"/>
        <result property="board_modifydate" column="board_modifydate"/>
        <result property="board_viewcount" column="board_viewcount"/>
    </resultMap>



</mapper>