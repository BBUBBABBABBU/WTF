<?xml version="1.0" encoding="UTF-8" ?>
        <!DOCTYPE mapper
                PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kosmo.orange.wtf.model.mapper.MainMapper">

    <select id="checkRestaurant" resultMap="getRestaurant">
        SELECT r.res_id as res_id,res_name,res_tell,res_addr,res_runtime,res_keyword,res_latitude,res_longitude,res_rating,like_count,ifnull(review_count,0) AS review_count
        FROM restaurant r
        LEFT OUTER JOIN (SELECT res_id,count(*) AS review_count
        FROM review_test rt
        GROUP BY res_id) rt
        ON r.res_id =rt.res_id
        ORDER BY res_rating DESC
    </select>

    <select id="res_photo" parameterType="RestaurantVO" resultType="PhotoVO">
        SELECT *
        FROM restaurant_pic rp
        WHERE res_id =#{resId}
        LIMIT 1
    </select>

    <select id="mainRecommend" resultMap="getRestaurant">
        SELECT r.res_id as res_id,res_name,res_tell,res_addr,res_runtime,res_keyword,res_latitude,res_longitude,res_rating,like_count,ifnull(review_count,0) AS review_count
        FROM restaurant r
        LEFT OUTER JOIN (SELECT res_id,count(*) AS review_count
        FROM review_test rt
        GROUP BY res_id) rt
        ON r.res_id =rt.res_id
        WHERE  res_addr LIKE CONCAT('%',#{resAddr},'%')
        ORDER BY res_rating DESC
    </select>

    <resultMap id="getRestaurant" type="RestaurantVO">
        <result property="resId" column="res_id"/>
        <result property="resName" column="res_name"/>
        <result property="resTell" column="res_tell"/>
        <result property="resAddr" column="res_addr"/>
        <result property="resLatitude" column="res_latitude"/>
        <result property="resLongitude" column="res_longitude"/>
        <result property="resRuntime" column="res_runtime"/>
        <result property="resKeyword" column="res_keyword"/>
        <result property="resRating" column="res_rating"/>
        <result property="likeCount" column="like_count"/>
    </resultMap>
</mapper>